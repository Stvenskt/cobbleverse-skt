<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COBBLEVERSE / SKT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&family=Reggae+One&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILO CYBERPUNK APP --- */
        :root {
            --bg-deep: #050b14;
            --glass: rgba(12, 20, 35, 0.95);
            --neon-cyan: #00f2ff;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --text-main: #e0f7fa;
            --card-paper: #f0e6d2; 
            --text-dark: #1a1a1a;
        }

        body {
            background-color: var(--bg-deep);
            background-image: 
                linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            padding-bottom: 120px;
            overflow-x: hidden;
        }

        /* HEADER */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; background: var(--glass); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 242, 255, 0.2); position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 5px 25px rgba(0,0,0,0.8); gap: 15px; flex-wrap: wrap;
        }

        .header-left { display: flex; align-items: center; gap: 15px; width: 100%; max-width: 500px; }
        
        .logo-container {
            width: 55px; height: 55px; border-radius: 50%; border: 2px solid var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan); overflow: hidden; background: #000; flex-shrink: 0;
        }
        .logo-img { width: 100%; height: 100%; object-fit: cover; }

        .search-box { position: relative; display: flex; align-items: center; flex-grow: 1; }
        .search-input {
            background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(0, 242, 255, 0.3); color: #fff;
            padding: 12px 15px 12px 40px; border-radius: 6px; font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem; width: 100%; transition: all 0.3s ease;
        }
        .search-input:focus { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); outline: none; }
        .search-icon { position: absolute; left: 12px; color: var(--neon-cyan); opacity: 0.8; pointer-events: none; }

        /* BOTONES */
        .nav-regions { display: flex; gap: 6px; flex-wrap: wrap; justify-content: flex-end; flex-grow: 1; }

        .btn-gen {
            background: rgba(0, 30, 50, 0.7); border: 1px solid rgba(0, 242, 255, 0.2); color: var(--neon-cyan);
            padding: 10px 12px; font-family: 'Orbitron', sans-serif; font-size: 0.7rem; text-transform: uppercase;
            cursor: pointer; transition: 0.2s; border-radius: 4px; text-align: center; flex-grow: 1; max-width: 80px;
        }
        .btn-gen.active { background: rgba(0, 242, 255, 0.2); color: #fff; border-color: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan); }
        .btn-mega { border-color: var(--neon-purple); color: var(--neon-purple); max-width: 100px; }
        .btn-mega.active { background: rgba(188, 19, 254, 0.25); box-shadow: 0 0 15px rgba(188, 19, 254, 0.4); }
        .btn-hisui { border-color: var(--neon-orange); color: var(--neon-orange); max-width: 100px; }
        .btn-hisui.active { background: rgba(255, 157, 0, 0.25); box-shadow: 0 0 15px rgba(255, 157, 0, 0.4); }

        /* GRID */
        .container {
            max-width: 1800px; margin: 30px auto; padding: 0 15px;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;
        }

        /* CARD */
        .card {
            background: rgba(20, 25, 35, 0.85); border: 1px solid rgba(255, 255, 255, 0.05);
            border-left: 5px solid var(--neon-red); border-radius: 12px; display: flex; flex-direction: column;
            transition: 0.3s; animation: fadeIn 0.4s ease-out forwards; opacity: 0;
        }
        @keyframes fadeIn { to { opacity: 1; } }
        .card:hover { transform: translateY(-5px); border-left-color: var(--neon-cyan); box-shadow: 0 10px 30px rgba(0,0,0,0.6); }

        .card-inner {
            background-color: var(--card-paper); background-image: url('https://www.transparenttextures.com/patterns/old-map.png');
            margin: 3px; border-radius: 8px; color: var(--text-dark); flex-grow: 1; position: relative;
            clip-path: polygon(25px 0, 100% 0, 100% calc(100% - 25px), calc(100% - 25px) 100%, 0 100%, 0 25px);
            padding-bottom: 20px;
        }
        .card-inner::after {
            content: '極秘'; position: absolute; top: 10px; right: 10px; font-family: 'Reggae One';
            font-size: 2.5rem; color: rgba(220, 20, 60, 0.1); transform: rotate(-20deg); pointer-events: none;
            border: 3px solid rgba(220, 20, 60, 0.1); padding: 2px 10px; border-radius: 12px;
        }

        .card-header { text-align: center; padding: 20px 10px 5px; }
        .jp-text { font-family: 'Reggae One'; color: var(--neon-red); font-size: 0.8rem; opacity: 0.7; margin-bottom: 5px; display: block; }
        
        .poke-img { width: 160px; height: 160px; object-fit: contain; filter: drop-shadow(0 8px 10px rgba(0,0,0,0.25)); transition: 0.3s; z-index: 2; position: relative; }
        .card:hover .poke-img { transform: scale(1.1); filter: drop-shadow(0 12px 20px rgba(0,0,0,0.35)); }

        .poke-name { font-family: 'Orbitron'; font-size: 1.3rem; font-weight: 900; margin: 10px 0; text-transform: uppercase; color: #111; line-height: 1.1; }
        .types { display: flex; justify-content: center; gap: 5px; }
        .type-badge { font-size: 0.7rem; padding: 4px 10px; border-radius: 4px; color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        .build-info { padding: 0 20px; }
        .role-badge {
            background: #0a0a0a; color: var(--neon-cyan); text-align: center; padding: 6px 0; font-weight: 900;
            font-size: 0.75rem; margin: 15px 0; border-top: 1px solid var(--neon-cyan); border-bottom: 1px solid var(--neon-cyan);
            letter-spacing: 2px;
        }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-label { font-size: 0.65rem; color: #666; font-weight: 700; text-transform: uppercase; }
        .stat-value { font-size: 0.85rem; font-weight: 700; color: #000; font-family: 'Rajdhani'; line-height: 1.1; }
        .highlight { color: #d60045; font-weight: 800; }

        .moves { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .move { background: rgba(0,0,0,0.05); padding: 6px; text-align: center; font-size: 0.75rem; font-weight: 700; color: #333; border: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; height: 35px; }

        /* MOBILE */
        @media (max-width: 768px) {
            header { padding: 15px; flex-direction: column; gap: 15px; }
            .header-left { width: 100%; max-width: 100%; }
            .nav-regions { width: 100%; gap: 5px; }
            .btn-gen { min-width: 45px; font-size: 0.65rem; }
            .container { grid-template-columns: 1fr; gap: 20px; }
        }

        /* COLORES */
        .t-fire { background: #e25822; } .t-water { background: #1e90ff; } .t-grass { background: #228b22; } .t-electric { background: #ffd700; color: #000; } .t-psychic { background: #ff1493; } .t-ice { background: #00ced1; } .t-dragon { background: #4b0082; } .t-dark { background: #2f2f2f; } .t-fairy { background: #ff69b4; } .t-normal { background: #a9a9a9; } .t-fighting { background: #b22222; } .t-flying { background: #87ceeb; color: #000; } .t-poison { background: #800080; } .t-ground { background: #d2691e; } .t-rock { background: #b8860b; } .t-bug { background: #9acd32; color: #000; } .t-ghost { background: #483d8b; } .t-steel { background: #708090; }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <div class="logo-container">
                <img src="dragon-logo.png" class="logo-img" alt="Logo">
            </div>
            <div class="search-box">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" class="search-input" id="searchInput" placeholder="BUSCAR POKÉMON..." onkeyup="handleSearch(event)">
            </div>
        </div>

        <div class="nav-regions">
            <button class="btn-gen active" onclick="loadGen(1)">Gen 1</button>
            <button class="btn-gen" onclick="loadGen(2)">Gen 2</button>
            <button class="btn-gen" onclick="loadGen(3)">Gen 3</button>
            <button class="btn-gen" onclick="loadGen(4)">Gen 4</button>
            <button class="btn-gen" onclick="loadGen(5)">Gen 5</button>
            <button class="btn-gen" onclick="loadGen(6)">Gen 6</button>
            <button class="btn-gen" onclick="loadGen(7)">Gen 7</button>
            <button class="btn-gen" onclick="loadGen(8)">Gen 8</button>
            <button class="btn-gen" onclick="loadGen(9)">Gen 9</button>
            <button class="btn-gen btn-mega" onclick="loadMegas()">MEGAS</button>
            <button class="btn-gen btn-hisui" onclick="loadHisui()">HISUI</button>
        </div>
    </header>

    <div class="container" id="pokedex"></div>

    <script>
        // === DATABASE COMPETITIVA MANUAL (PERFECT BUILDS PARA MEGAS) ===
        const competitiveDatabase = {
            "Mega Abomasnow": { role: "MIXED ATTACKER", ability: "Nevada", nature: "Mansa (+SpA, -Vel)", item: "Abomasnowita", evs: "252 HP / 4 Atq / 252 SpA", moves: ["Ventisca", "Gigadrenado", "Terremoto", "Canto Helado"] },
            "Mega Absol": { role: "MAGIC BOUNCE", ability: "Espejo Mágico", nature: "Alegre (+Vel, -SpA)", item: "Absolita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Desarme", "Golpe Bajo", "Carantoña", "Danza Espada"] },
            "Mega Aerodactyl": { role: "PURSUIT TRAPPER", ability: "Garra Dura", nature: "Alegre", item: "Aerodactylita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Roca Afilada", "Terremoto", "Golpe Aéreo", "Persecución"] },
            "Mega Aggron": { role: "TANK FÍSICO", ability: "Filtro", nature: "Agitada (+Def, -SpA)", item: "Aggronita", evs: "252 HP / 4 Def / 252 SpD", moves: ["Cuerpo Pesado", "Trampa Rocas", "Onda Trueno", "Terremoto"] },
            "Mega Alakazam": { role: "REVENGE KILLER", ability: "Rastro", nature: "Miedosa (+Vel, -Atq)", item: "Alakazamita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Psíquico", "Onda Certera", "Bola Sombra", "Recuperación"] },
            "Mega Altaria": { role: "DRAGON DANCE", ability: "Piel Feérica", nature: "Alegre", item: "Altarianita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Danza Dragón", "Retribución", "Terremoto", "Respiro"] },
            "Mega Ampharos": { role: "PIVOT LENTO", ability: "Rompemoldes", nature: "Modesta (+SpA, -Atq)", item: "Ampharosita", evs: "252 HP / 252 SpA / 4 SpD", moves: ["Voltiocambio", "Pulso Dragón", "Onda Certera", "Agilidad"] },
            "Mega Audino": { role: "CLERIC SOPORTE", ability: "Alma Cura", nature: "Osada (+Def, -Atq)", item: "Audinita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Deseo", "Protección", "Voz Cautivadora", "Tóxico"] },
            "Mega Banette": { role: "PRANKSTER DESTINY", ability: "Bromista", nature: "Firme (+Atq, -SpA)", item: "Banettita", evs: "252 HP / 252 Atq / 4 SpD", moves: ["Sombra Vil", "Mismo Destino", "Fuego Fatuo", "Desarme"] },
            "Mega Barbaracle": { role: "SHELL SMASH", ability: "Garra Dura", nature: "Firme", item: "Barbaraclita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Rompecoraza", "Concha Filo", "Roca Afilada", "Tajo Cruzado"] },
            "Mega Baxcalibur": { role: "DRAGON DANCE", ability: "Termoconversión", nature: "Alegre", item: "Baxcaliburita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Asalto Espadón", "Chuzos", "Terremoto", "Danza Dragón"] },
            "Mega Beedrill": { role: "GLASS CANNON", ability: "Adaptable", nature: "Alegre", item: "Beedrillita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Puya Nociva", "Ida y Vuelta", "Taladradora", "Desarme"] },
            "Mega Blastoise": { role: "WALLBREAKER", ability: "Megadisparador", nature: "Modesta", item: "Blastoisita", evs: "252 HP / 252 SpA / 4 Vel", moves: ["Hidrobomba", "Pulso Umbrío", "Esfera Aural", "Giro Rápido"] },
            "Mega Blaziken": { role: "SWEEPER", ability: "Impulso", nature: "Firme", item: "Blazikenita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Envite Ígneo", "Patada Salto Alta", "Protección", "Danza Espada"] },
            "Mega Camerupt": { role: "TRICK ROOM", ability: "Potencia Bruta", nature: "Mansa", item: "Cameruptita", evs: "252 HP / 252 SpA / 4 SpD", moves: ["Estallido", "Tierra Viva", "Lanzallamas", "Poder Pasado"] },
            "Mega Chandelure": { role: "SHADOW TAG", ability: "Sombra Trampa", nature: "Miedosa", item: "Chandelurita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Bola Sombra", "Lanzallamas", "Paz Mental", "Sustituto"] },
            "Mega Charizard X": { role: "DRAGON DANCE", ability: "Garra Dura", nature: "Alegre", item: "Charizardita X", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Envite Ígneo", "Garra Dragón", "Respiro"] },
            "Mega Charizard Y": { role: "WALLBREAKER", ability: "Sequía", nature: "Miedosa", item: "Charizardita Y", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Lanzallamas", "Rayo Solar", "Onda Certera", "Respiro"] },
            "Mega Chesnaught": { role: "TANK", ability: "Antibalas", nature: "Agitada", item: "Chesnaughtita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Mazazo", "Drenadoras", "Barrera Espinosa", "Puño Drenaje"] },
            "Mega Chimecho": { role: "CLERIC", ability: "Levitación", nature: "Serena", item: "Chimechita", evs: "252 HP / 4 Def / 252 SpD", moves: ["Deseo", "Protección", "Psíquico", "Campana Cura"] },
            "Mega Clefable": { role: "MAGIC GUARD", ability: "Muro Mágico", nature: "Osada", item: "Clefablita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Fuerza Lunar", "Luz Lunar", "Paz Mental", "Lanzallamas"] },
            "Mega Delphox": { role: "MAGICIAN", ability: "Muro Mágico", nature: "Miedosa", item: "Delphoxita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Llamarada", "Psíquico", "Hierba Lazo", "Paz Mental"] },
            "Mega Diancie": { role: "MIXED", ability: "Espejo Mágico", nature: "Ingenua (+Vel, -SpD)", item: "Diancita", evs: "4 Atq / 252 SpA / 252 Vel", moves: ["Fuerza Lunar", "Tormenta de Diamantes", "Tierra Viva", "Protección"] },
            "Mega Dragalge": { role: "ADAPTABILITY", ability: "Adaptable", nature: "Modesta", item: "Dragalgita", evs: "252 HP / 252 SpA / 4 SpD", moves: ["Cometa Draco", "Bomba Lodo", "Onda Certera", "Púas Tóxicas"] },
            "Mega Dragonite": { role: "MULTISCALE", ability: "Compensación", nature: "Firme", item: "Dragonita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Velocidad Extrema", "Garra Dragón", "Terremoto"] },
            "Mega Drampa": { role: "BERSERK", ability: "Cólera", nature: "Modesta", item: "Drampita", evs: "252 HP / 252 SpA / 4 SpD", moves: ["Vozarrón", "Pulso Dragón", "Lanzallamas", "Respiro"] },
            "Mega Eelektross": { role: "NO WEAKNESS", ability: "Levitación", nature: "Mansa", item: "Eelektrossita", evs: "252 HP / 252 Atq / 4 SpA", moves: ["Voltio Cruel", "Gigadrenado", "Lanzallamas", "Desarme"] },
            "Mega Emboar": { role: "RECKLESS", ability: "Audaz", nature: "Firme", item: "Emboarita", evs: "252 HP / 252 Atq / 4 Vel", moves: ["Envite Ígneo", "Fuerza Bruta", "Voltio Cruel", "Golpe Bajo"] },
            "Mega Excadrill": { role: "SAND RUSH", ability: "Ímpetu Arena", nature: "Alegre", item: "Excadrillita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Terremoto", "Cabeza de Hierro", "Avalancha", "Danza Espada"] },
            "Mega Falinks": { role: "NO RETREAT", ability: "Competitivo", nature: "Alegre", item: "Falinksita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Bastión Final", "A Bocajarro", "Cabeza de Hierro", "Golpe Mordaza"] },
            "Mega Feraligatr": { role: "SHEER FORCE", ability: "Potencia Bruta", nature: "Alegre", item: "Feraligatrita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Cascada", "Puño Hielo", "Triturar"] },
            "Mega Floette": { role: "ETERNAL", ability: "Velo Flor", nature: "Modesta", item: "Floettita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Luz Aniquiladora", "Fuerza Lunar", "Psíquico", "Síntesis"] },
            "Mega Froslass": { role: "SPIKER", ability: "Cuerpo Maldito", nature: "Miedosa", item: "Froslassita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Púas", "Rayo Hielo", "Bola Sombra", "Mismo Destino"] },
            "Mega Gallade": { role: "SWORDS DANCE", ability: "Foco Interno", nature: "Alegre", item: "Galladita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Espada", "A Bocajarro", "Cabezazo Zen", "Desarme"] },
            "Mega Garchomp": { role: "MIXED", ability: "Poder Arena", nature: "Ingenua", item: "Garchompita", evs: "4 Atq / 252 SpA / 252 Vel", moves: ["Cometa Draco", "Terremoto", "Llamarada", "Roca Afilada"] },
            "Mega Gardevoir": { role: "WALLBREAKER", ability: "Piel Feérica", nature: "Modesta", item: "Gardevoirita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Vozarrón", "Psíquico", "Onda Certera", "Paz Mental"] },
            "Mega Gengar": { role: "TRAPPER", ability: "Sombra Trampa", nature: "Miedosa", item: "Gengarita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Bola Sombra", "Bomba Lodo", "Onda Certera", "Mismo Destino"] },
            "Mega Glalie": { role: "EXPLOSION", ability: "Piel Helada", nature: "Alegre", item: "Glalita", evs: "252 Atq / 4 SpD / 252 Vel", moves: ["Retribución", "Explosión", "Terremoto", "Liofilización"] },
            "Mega Greninja": { role: "PROTEAN", ability: "Mutatipo", nature: "Ingenua", item: "Greninjita", evs: "4 Atq / 252 SpA / 252 Vel", moves: ["Hidrobomba", "Pulso Umbrío", "Rayo Hielo", "Lanza Mugre"] },
            "Mega Gyarados": { role: "MOLD BREAKER", ability: "Rompemoldes", nature: "Alegre", item: "Gyaradosita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Cascada", "Triturar", "Terremoto"] },
            "Mega Hawlucha": { role: "UNBURDEN", ability: "Rompemoldes", nature: "Alegre", item: "Hawluchita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Espada", "Acróbata", "Patada Salto Alta", "Respiro"] },
            "Mega Heracross": { role: "SKILL LINK", ability: "Encadenado", nature: "Firme", item: "Heracrossita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Pedrada", "Pin Misil", "A Bocajarro", "Danza Espada"] },
            "Mega Houndoom": { role: "SUN SWEEPER", ability: "Poder Solar", nature: "Miedosa", item: "Houndoomita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Llamarada", "Pulso Umbrío", "Bomba Lodo", "Maquinación"] },
            "Mega Kangaskhan": { role: "PARENTAL BOND", ability: "Amor Filial", nature: "Alegre", item: "Kangaskhanita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Sorpresa", "Retribución", "Puño Incremento", "Golpe Bajo"] },
            "Mega Latias": { role: "CM TANK", ability: "Levitación", nature: "Miedosa", item: "Latiasita", evs: "252 HP / 4 Def / 252 Vel", moves: ["Paz Mental", "Recuperación", "Fuerza Masa", "Rayo Hielo"] },
            "Mega Latios": { role: "MIXED", ability: "Levitación", nature: "Ingenua", item: "Latiosita", evs: "4 Atq / 252 SpA / 252 Vel", moves: ["Cometa Draco", "Psíquico", "Terremoto", "Recuperación"] },
            "Mega Lopunny": { role: "SCRAPPY", ability: "Intrépido", nature: "Alegre", item: "Lopunnita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Retribución", "Patada Salto Alta", "Sorpresa", "Puño Hielo"] },
            "Mega Lucario": { role: "PHYSICAL", ability: "Adaptable", nature: "Alegre", item: "Lucarita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["A Bocajarro", "Puño Bala", "Cola Férrea", "Danza Espada"] },
            "Mega Lucario Z": { role: "SPECIAL", ability: "Adaptable", nature: "Miedosa", item: "Lucarita Z", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Esfera Aural", "Foco Resplandor", "Onda Vacío", "Maquinación"] },
            "Mega Malamar": { role: "CONTRARY", ability: "Respondón", nature: "Cauta", item: "Malamarita", evs: "252 HP / 252 SpD / 4 Vel", moves: ["Fuerza Bruta", "Desarme", "Descanso", "Sonámbulo"] },
            "Mega Manectric": { role: "INTIMIDATE", ability: "Intimidación", nature: "Miedosa", item: "Manectricita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Voltiocambio", "Rayo", "Lanzallamas", "Poder Oculto Hielo"] },
            "Mega Mawile": { role: "HUGE POWER", ability: "Potencia", nature: "Firme", item: "Mawilita", evs: "252 HP / 252 Atq / 4 Vel", moves: ["Carantoña", "Golpe Bajo", "Cabeza de Hierro", "Danza Espada"] },
            "Mega Medicham": { role: "PURE POWER", ability: "Potencia Pura", nature: "Alegre", item: "Medichamita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Patada Salto Alta", "Cabezazo Zen", "Sorpresa", "Puño Hielo"] },
            "Mega Meganium": { role: "TANK", ability: "Muro Mágico", nature: "Serena", item: "Meganiumita", evs: "252 HP / 4 Def / 252 SpD", moves: ["Gigadrenado", "Drenadoras", "Aromaterapia", "Síntesis"] },
            "Mega Metagross": { role: "TOUGH CLAWS", ability: "Garra Dura", nature: "Alegre", item: "Metagrossita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Puño Meteoro", "Cabezazo Zen", "Terremoto", "Puño Hielo"] },
            "Mega Mewtwo X": { role: "FIGHTER", ability: "Impasible", nature: "Alegre", item: "Mewtwoita X", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Patada Baja", "Cabezazo Zen", "Terremoto", "Puño Hielo"] },
            "Mega Mewtwo Y": { role: "PSYCHIC GOD", ability: "Insomnio", nature: "Miedosa", item: "Mewtwoita Y", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Onda Mental", "Rayo Hielo", "Llamarada", "Paz Mental"] },
            "Mega Pidgeot": { role: "NO GUARD", ability: "Indefenso", nature: "Miedosa", item: "Pidgeotita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Vendaval", "Onda Ígnea", "Ida y Vuelta", "Respiro"] },
            "Mega Pinsir": { role: "AERILATE", ability: "Piel Celeste", nature: "Alegre", item: "Pinsirita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Espada", "Retribución", "Ataque Rápido", "A Bocajarro"] },
            "Mega Pyroar": { role: "ROYAL ROAR", ability: "Piel Feérica", nature: "Miedosa", item: "Pyroarita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Vozarrón", "Lanzallamas", "Poder Oculto Planta", "Fuego Fatuo"] },
            "Mega Raichu X": { role: "PHYSICAL", ability: "Potencia", nature: "Alegre", item: "Raichunita X", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Placaje Eléctrico", "Sorpresa", "Desarme", "Velocidad Extrema"] },
            "Mega Raichu Y": { role: "SPECIAL", ability: "Pararrayos", nature: "Miedosa", item: "Raichunita Y", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Rayo", "Surf", "Onda Certera", "Maquinación"] },
            "Mega Rayquaza": { role: "AG", ability: "Ráfaga Delta", nature: "Alegre", item: "Sin Objeto", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Ascenso Draco", "Danza Dragón", "Terremoto", "Velocidad Extrema"] },
            "Mega Sableye": { role: "WALL", ability: "Espejo Mágico", nature: "Osada", item: "Sableyita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Fuego Fatuo", "Recuperación", "Desarme", "Protección"] },
            "Mega Salamence": { role: "AERILATE", ability: "Piel Celeste", nature: "Alegre", item: "Salamencita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Retribución", "Terremoto", "Respiro"] },
            "Mega Sceptile": { role: "LIGHTNING ROD", ability: "Pararrayos", nature: "Miedosa", item: "Sceptilita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Lluevehojas", "Pulso Dragón", "Onda Certera", "Sustituto"] },
            "Mega Scizor": { role: "TECHNICIAN", ability: "Experto", nature: "Firme", item: "Scizorita", evs: "248 HP / 252 Atq / 8 SpD", moves: ["Danza Espada", "Puño Bala", "Picadura", "Respiro"] },
            "Mega Scolipede": { role: "SPEED BOOST", ability: "Impulso", nature: "Alegre", item: "Scolipedita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Espada", "Megacuerno", "Puya Nociva", "Terremoto"] },
            "Mega Scrafty": { role: "INTIMIDATE", ability: "Intimidación", nature: "Firme", item: "Scraftita", evs: "252 HP / 252 Atq / 4 SpD", moves: ["Danza Dragón", "Puño Drenaje", "Desarme", "Puño Hielo"] },
            "Mega Sharpedo": { role: "STRONG JAW", ability: "Mandíbula Fuerte", nature: "Firme", item: "Sharpedonita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Triturar", "Colmillo Hielo", "Protección", "Psicocolmillo"] },
            "Mega Skarmory": { role: "WALL", ability: "Armadura Frágil", nature: "Agitada", item: "Skarmorita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Púas", "Respiro", "Pájaro Osado", "Remolino"] },
            "Mega Slowbro": { role: "TANK", ability: "Caparazón", nature: "Osada", item: "Slowbronita", evs: "252 HP / 252 Def / 4 SpD", moves: ["Escaldar", "Psíquico", "Paz Mental", "Relajo"] },
            "Mega Starmie": { role: "ANALYTIC", ability: "Cálculo Final", nature: "Miedosa", item: "Starmiita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Hidrobomba", "Psíquico", "Rayo Hielo", "Giro Rápido"] },
            "Mega Steelix": { role: "SAND FORCE", ability: "Poder Arena", nature: "Firme", item: "Steelixita", evs: "252 HP / 252 Atq / 4 SpD", moves: ["Cuerpo Pesado", "Terremoto", "Roca Afilada", "Trampa Rocas"] },
            "Mega Swampert": { role: "RAIN SWEEPER", ability: "Nado Rápido", nature: "Firme", item: "Swampertita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Cascada", "Terremoto", "Puño Hielo", "Fuerza Bruta"] },
            "Mega Tyranitar": { role: "SAND STREAM", ability: "Chorro Arena", nature: "Alegre", item: "Tyranitarita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Danza Dragón", "Roca Afilada", "Triturar", "Puño Hielo"] },
            "Mega Venusaur": { role: "THICK FAT", ability: "Sebo", nature: "Modesta", item: "Venusaurita", evs: "252 HP / 252 SpA / 4 Vel", moves: ["Gigadrenado", "Bomba Lodo", "Poder Oculto Fuego", "Síntesis"] },
            "Mega Victreebel": { role: "TRAPPER", ability: "Trampa Arena", nature: "Modesta", item: "Victreebelita", evs: "252 SpA / 4 SpD / 252 Vel", moves: ["Bomba Lodo", "Lluevehojas", "Meteorobola", "Desarrollo"] },
            "Mega Zeraora": { role: "ELECTRIC GOD", ability: "Transistor", nature: "Alegre", item: "Zeraorita", evs: "252 Atq / 4 Def / 252 Vel", moves: ["Puños Plasma", "A Bocajarro", "Desarme", "Puño Hielo"] },
            "Mega Zygarde": { role: "COMPLETE", ability: "Agrupamiento", nature: "Firme", item: "Restos", evs: "252 HP / 252 Atq / 4 SpD", moves: ["Mil Flechas", "Velocidad Extrema", "Enrosque", "Sustituto"] }
        };

        // LISTA DE ID PARA IMÁGENES
        const megaKeys = [
            { name: "Mega Abomasnow", query: "abomasnow-mega" }, { name: "Mega Absol", query: "absol-mega" },
            { name: "Mega Aerodactyl", query: "aerodactyl-mega" }, { name: "Mega Aggron", query: "aggron-mega" },
            { name: "Mega Alakazam", query: "alakazam-mega" }, { name: "Mega Altaria", query: "altaria-mega" },
            { name: "Mega Ampharos", query: "ampharos-mega" }, { name: "Mega Audino", query: "audino-mega" },
            { name: "Mega Banette", query: "banette-mega" }, { name: "Mega Barbaracle", query: "barbaracle" },
            { name: "Mega Baxcalibur", query: "baxcalibur" }, { name: "Mega Beedrill", query: "beedrill-mega" },
            { name: "Mega Blastoise", query: "blastoise-mega" }, { name: "Mega Blaziken", query: "blaziken-mega" },
            { name: "Mega Camerupt", query: "camerupt-mega" }, { name: "Mega Chandelure", query: "chandelure" },
            { name: "Mega Charizard X", query: "charizard-mega-x" }, { name: "Mega Charizard Y", query: "charizard-mega-y" },
            { name: "Mega Chesnaught", query: "chesnaught" }, { name: "Mega Chimecho", query: "chimecho" },
            { name: "Mega Clefable", query: "clefable" }, { name: "Mega Delphox", query: "delphox" },
            { name: "Mega Diancie", query: "diancie-mega" }, { name: "Mega Dragalge", query: "dragalge" },
            { name: "Mega Dragonite", query: "dragonite" }, { name: "Mega Drampa", query: "drampa" },
            { name: "Mega Eelektross", query: "eelektross" }, { name: "Mega Emboar", query: "emboar" },
            { name: "Mega Excadrill", query: "excadrill" }, { name: "Mega Falinks", query: "falinks" },
            { name: "Mega Feraligatr", query: "feraligatr" }, { name: "Mega Floette", query: "floette" },
            { name: "Mega Froslass", query: "froslass" }, { name: "Mega Gallade", query: "gallade-mega" },
            { name: "Mega Garchomp", query: "garchomp-mega" }, { name: "Mega Gardevoir", query: "gardevoir-mega" },
            { name: "Mega Gengar", query: "gengar-mega" }, { name: "Mega Glalie", query: "glalie-mega" },
            { name: "Mega Greninja", query: "greninja" }, { name: "Mega Gyarados", query: "gyarados-mega" },
            { name: "Mega Hawlucha", query: "hawlucha" }, { name: "Mega Heracross", query: "heracross-mega" },
            { name: "Mega Houndoom", query: "houndoom-mega" }, { name: "Mega Kangaskhan", query: "kangaskhan-mega" },
            { name: "Mega Latias", query: "latias-mega" }, { name: "Mega Latios", query: "latios-mega" },
            { name: "Mega Lopunny", query: "lopunny-mega" }, { name: "Mega Lucario", query: "lucario-mega" },
            { name: "Mega Lucario Z", query: "lucario" }, { name: "Mega Malamar", query: "malamar" },
            { name: "Mega Manectric", query: "manectric-mega" }, { name: "Mega Mawile", query: "mawile-mega" },
            { name: "Mega Medicham", query: "medicham-mega" }, { name: "Mega Meganium", query: "meganium" },
            { name: "Mega Metagross", query: "metagross-mega" }, { name: "Mega Mewtwo X", query: "mewtwo-mega-x" },
            { name: "Mega Mewtwo Y", query: "mewtwo-mega-y" }, { name: "Mega Pidgeot", query: "pidgeot-mega" },
            { name: "Mega Pinsir", query: "pinsir-mega" }, { name: "Mega Pyroar", query: "pyroar" },
            { name: "Mega Raichu X", query: "raichu" }, { name: "Mega Raichu Y", query: "raichu" },
            { name: "Mega Rayquaza", query: "rayquaza-mega" }, { name: "Mega Sableye", query: "sableye-mega" },
            { name: "Mega Salamence", query: "salamence-mega" }, { name: "Mega Sceptile", query: "sceptile-mega" },
            { name: "Mega Scizor", query: "scizor-mega" }, { name: "Mega Scolipede", query: "scolipede" },
            { name: "Mega Scrafty", query: "scrafty" }, { name: "Mega Sharpedo", query: "sharpedo-mega" },
            { name: "Mega Skarmory", query: "skarmory" }, { name: "Mega Slowbro", query: "slowbro-mega" },
            { name: "Mega Starmie", query: "starmie" }, { name: "Mega Steelix", query: "steelix-mega" },
            { name: "Mega Swampert", query: "swampert-mega" }, { name: "Mega Tyranitar", query: "tyranitar-mega" },
            { name: "Mega Venusaur", query: "venusaur-mega" }, { name: "Mega Victreebel", query: "victreebel" },
            { name: "Mega Zeraora", query: "zeraora" }, { name: "Mega Zygarde", query: "zygarde-complete" }
        ];

        // ORDENAR ALFABÉTICAMENTE
        megaKeys.sort((a, b) => a.name.localeCompare(b.name));

        // --- POOL DE ATAQUES INTELIGENTES (Para Generador) ---
        const smartMovePool = {
            fire: { phys: ["Envite Ígneo", "Puño Fuego", "Patada Ígnea"], spec: ["Lanzallamas", "Llamarada", "Sofoco"] },
            water: { phys: ["Cascada", "Acua Cola", "Envite Acuático"], spec: ["Hidrobomba", "Surf", "Escaldar"] },
            grass: { phys: ["Mazazo", "Hoja Aguda", "Latigazo"], spec: ["Gigadrenado", "Lluevehojas", "Energibola"] },
            electric: { phys: ["Voltio Cruel", "Puño Trueno", "Placaje Eléc."], spec: ["Rayo", "Trueno", "Voltiocambio"] },
            ice: { phys: ["Chuzos", "Puño Hielo", "Canto Helado"], spec: ["Rayo Hielo", "Ventisca", "Liofilización"] },
            fighting: { phys: ["A Bocajarro", "Fuerza Bruta", "Puño Drenaje"], spec: ["Onda Certera", "Esfera Aural", "Onda Vacío"] },
            poison: { phys: ["Puya Nociva", "Lanza Mugre"], spec: ["Bomba Lodo", "Onda Tóxica"] },
            ground: { phys: ["Terremoto", "Taladradora"], spec: ["Tierra Viva", "Disparo Lodo"] },
            flying: { phys: ["Pájaro Osado", "Golpe Aéreo", "Acróbata"], spec: ["Vendaval", "Tajo Aéreo"] },
            psychic: { phys: ["Cabezazo Zen", "Psicocorte"], spec: ["Psíquico", "Psicocarga", "Premonición"] },
            bug: { phys: ["Ida y Vuelta", "Tijera X", "Megacuerno"], spec: ["Zumbido", "Estoicismo"] },
            rock: { phys: ["Roca Afilada", "Avalancha", "Pedrada"], spec: ["Poder Pasado", "Joya de Luz"] },
            ghost: { phys: ["Garra Umbría", "Sombra Vil", "Golpe Fantasma"], spec: ["Bola Sombra", "Infortunio"] },
            dragon: { phys: ["Garra Dragón", "Enfado", "Cola Dragón"], spec: ["Cometa Draco", "Pulso Dragón"] },
            steel: { phys: ["Cabeza de Hierro", "Puño Bala", "Cuerpo Pesado"], spec: ["Foco Resplandor", "Disparo Espejo"] },
            dark: { phys: ["Desarme", "Golpe Bajo", "Triturar"], spec: ["Pulso Umbrío", "Alarido"] },
            fairy: { phys: ["Carantoña", "Espíritu Vital"], spec: ["Fuerza Lunar", "Brillo Mágico"] },
            normal: { phys: ["Retribución", "Doble Filo", "Velocidad Extrema"], spec: ["Vozarrón", "Hiperrayo"] },
            status: ["Protección", "Tóxico", "Onda Trueno", "Danza Espada", "Maquinación", "Paz Mental", "Trampa Rocas", "Despejar"]
        };

        // DICCIONARIOS GENÉRICOS
        const typeDict = { fire: "Fuego", water: "Agua", grass: "Planta", electric: "Eléctrico", psychic: "Psíquico", ice: "Hielo", dragon: "Dragón", dark: "Siniestro", fairy: "Hada", normal: "Normal", fighting: "Lucha", flying: "Volador", poison: "Veneno", ground: "Tierra", rock: "Roca", bug: "Bicho", ghost: "Fantasma", steel: "Acero" };
        const abilityDict = { "overgrow": "Espesura", "chlorophyll": "Clorofila", "blaze": "Mar Llamas", "solar-power": "Poder Solar", "torrent": "Torrente", "levitate": "Levitación", "pressure": "Presión", "static": "Elec. Estática", "sand-veil": "Velo Arena", "intimidate": "Intimidación", "mold-breaker": "Rompemoldes", "adaptability": "Adaptable", "drizzle": "Llovizna", "drought": "Sequía", "magic-bounce": "Espejo Mágico", "thick-fat": "Sebo", "speed-boost": "Impulso", "huge-power": "Potencia", "pure-power": "Potencia Pura", "transistor": "Transistor", "quark-drive": "Carga Cuark", "protosynthesis": "Paleosíntesis", "beast-boost": "Ultraimpulso", "trace": "Rastro", "swift-swim": "Nado Rápido", "synchronize": "Sincronía", "guts": "Agallas", "inner-focus": "Foco Interno", "keen-eye": "Vista Lince", "rock-head": "Cabeza Roca", "sturdy": "Robustez", "magnet-pull": "Imán", "clear-body": "Cuerpo Puro", "natural-cure": "Cura Natural", "serene-grace": "Dicha", "effect-spore": "Efecto Espora", "rivalry": "Rivalidad", "flash-fire": "Absorbe Fuego", "justified": "Justiciero", "magic-guard": "Muro Mágico", "no-guard": "Indefenso", "technician": "Experto", "download": "Descarga", "super-luck": "Afortunado", "poison-touch": "Toque Tóxico", "regenerator": "Regeneración", "sheer-force": "Potencia Bruta", "prankster": "Bromista", "sand-rush": "Ímpetu Arena", "iron-barbs": "Punta Acero", "multiscale": "Compensación", "shadow-tag": "Sombra Trampa", "compound-eyes": "Ojo Compuesto", "snow-warning": "Nevada", "pixilate": "Piel Feérica", "aerilate": "Piel Celeste", "refrigerate": "Piel Helada", "tough-claws": "Garra Dura", "strong-jaw": "Mandíbula Fuerte", "mega-launcher": "Megadisparador", "bulletproof": "Antibalas", "competitive": "Tenacidad", "cursed-body": "Cuerpo Maldito", "moxie": "Autoestima", "sap-sipper": "Herbívoro", "storm-drain": "Colector", "hydration": "Hidratación", "quick-feet": "Pies Rápidos", "insomnia": "Insomnio", "vital-spirit": "Espíritu Vital", "limber": "Flexibilidad", "damp": "Humedad", "water-absorb": "Absorbe Agua", "volt-absorb": "Absorbe Elec.", "unburden": "Liviano", "poison-heal": "Antídoto", "battle-armor": "Armadura Batalla", "shell-armor": "Caparazón", "swarm": "Enjambre", "immunity": "Inmunidad", "own-tempo": "Ritmo Propio", "oblivious": "Despiste", "cloud-nine": "Aclimatación", "cute-charm": "Gran Encanto", "poison-point": "Punto Tóxico", "shed-skin": "Mudar", "run-away": "Fuga", "illuminate": "Iluminación", "pickup": "Recogida", "hustle": "Entusiasmo", "marvel-scale": "Escama Esp.", "forecast": "Predicción", "filter": "Filtro", "solid-rock": "Roca Sólida", "anger-point": "Irascible", "frisk": "Cacheo", "reckless": "Audaz", "multitype": "Multitipo", "flower-gift": "Don Floral", "bad-dreams": "Mal Sueño", "pickpocket": "Hurto", "infiltrator": "Allanamiento", "unnerve": "Nerviosismo", "defiant": "Competitivo", "telepathy": "Telepatía", "moody": "Veleta", "overcoat": "Funda", "harvest": "Cosecha", "weak-armor": "Armadura Frágil", "heavy-metal": "Metal Pesado", "light-metal": "Metal Liviano", "soul-heart": "Coránima" };

        function formatText(str) { 
            if (!str) return "Desconocida";
            return abilityDict[str] || str.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); 
        }

        // === GENERADOR DE ESTRATEGIAS (SMART BUILD) ===
        function generateSmartBuild(data) {
            const stats = data.stats;
            const types = data.types.map(t => t.type.name);
            const atk = stats[1].base_stat;
            const spa = stats[3].base_stat;
            const def = stats[2].base_stat;
            const spd = stats[4].base_stat;
            const spe = stats[5].base_stat;

            // 1. Determinar Rol y Categoría
            let category = (atk > spa) ? "phys" : "spec";
            let role = "BALANCEADO";
            if (spe >= 100) role = "SWEEPER VELOZ";
            else if (def >= 100 || spd >= 100) role = "TANQUE";
            else if (atk >= 110 || spa >= 110) role = "ROMPE MUROS";

            // 2. Elegir Naturaleza y Objeto
            let nature = "Rara";
            let item = "Restos";
            let evs = "252 HP / 128 Def / 128 SpD";

            if (role.includes("SWEEPER") || role.includes("ROMPE")) {
                item = "Vidasfera";
                if (category === "phys") {
                    nature = (spe >= 100) ? "Alegre" : "Firme";
                    evs = "252 Atq / 4 Def / 252 Vel";
                } else {
                    nature = (spe >= 100) ? "Miedosa" : "Modesta";
                    evs = "252 SpA / 4 Def / 252 Vel";
                }
            } else {
                nature = (def > spd) ? "Agitada" : "Serena";
                item = "Restos";
                evs = "252 HP / 128 Def / 128 SpD";
            }

            // 3. Generar Movimientos (2 STAB + 1 Cobertura + 1 Estado)
            let moves = [];
            
            // STAB 1 (Tipo Principal)
            if (smartMovePool[types[0]] && smartMovePool[types[0]][category]) {
                moves.push(smartMovePool[types[0]][category][0]);
            } else { moves.push("Golpe Cuerpo"); }

            // STAB 2 (Tipo Secundario o Cobertura)
            if (types[1] && smartMovePool[types[1]] && smartMovePool[types[1]][category]) {
                moves.push(smartMovePool[types[1]][category][0]);
            } else {
                // Si no tiene 2do tipo, buscar cobertura lógica
                let coverType = (category === "phys") ? "ground" : "ice"; 
                if (types[0] === "ground") coverType = "rock";
                if (types[0] === "ice") coverType = "electric";
                moves.push(smartMovePool[coverType][category][0]);
            }

            // Movimiento 3 (Cobertura fuerte)
            let cover2 = (category === "phys") ? "fighting" : "psychic";
            if (types.includes("fighting")) cover2 = "dark";
            moves.push(smartMovePool[cover2][category][0]);

            // Movimiento 4 (Estado/Utility)
            moves.push(smartMovePool.status[Math.floor(Math.random() * 3)]); // Protección, Tóxico o Onda Trueno

            return { role, nature, item, evs, moves };
        }

        // --- RENDER CARD ---
        function renderCard(data, customName) {
            const typesHtml = data.types.map(t => {
                const typeName = typeof t === 'string' ? t : t.type.name;
                return `<span class="type-badge t-${typeName}">${typeDict[typeName] || typeName}</span>`;
            }).join('');

            let sprite = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png';
            if(data.sprites.other['home'].front_default) sprite = data.sprites.other['home'].front_default;
            else if(data.sprites.other['official-artwork'].front_default) sprite = data.sprites.other['official-artwork'].front_default;
            else if(data.sprites.front_default) sprite = data.sprites.front_default;

            // Decidir Build (Manual o Smart)
            const manualBuild = competitiveDatabase[customName || data.name];
            let finalBuild = {};

            const bestAbilityObj = data.abilities.find(a => a.is_hidden) || data.abilities[0];
            const abilityName = bestAbilityObj ? bestAbilityObj.ability.name : "unknown";

            if (manualBuild) {
                finalBuild = { ...manualBuild, ability: formatText(manualBuild.ability) }; // Usar manual
            } else {
                const smart = generateSmartBuild(data); // Generar automática
                finalBuild = {
                    role: smart.role,
                    ability: formatText(abilityName),
                    item: smart.item,
                    nature: smart.nature,
                    evs: smart.evs,
                    moves: smart.moves
                };
            }

            return `
                <div class="card">
                    <div class="card-inner">
                        <div class="card-header">
                            <span class="jp-text">モンスターデータ</span>
                            <img src="${sprite}" class="poke-img" loading="lazy">
                            <div class="poke-name">${customName || data.name}</div>
                            <div class="types">${typesHtml}</div>
                        </div>
                        <div class="build-info">
                            <div class="role-badge">${finalBuild.role}</div>
                            <div class="stats">
                                <div class="stat-item"><span class="stat-label">Habilidad</span><span class="stat-value highlight">${finalBuild.ability}</span></div>
                                <div class="stat-item"><span class="stat-label">Objeto</span><span class="stat-value">${finalBuild.item}</span></div>
                                <div class="stat-item"><span class="stat-label">Naturaleza</span><span class="stat-value">${finalBuild.nature}</span></div>
                                <div class="stat-item"><span class="stat-label">EVs</span><span class="stat-value" style="font-size:0.75rem">${finalBuild.evs}</span></div>
                            </div>
                            <div class="moves">
                                ${finalBuild.moves.map(m => `<div class="move">${m}</div>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        async function fetchPokemon(query, customName) {
            try {
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${query}`);
                if (!res.ok) return '';
                const data = await res.json();
                return renderCard(data, customName);
            } catch (e) { return ''; }
        }

        async function loadMegas() {
            const container = document.getElementById('pokedex');
            container.innerHTML = '<h3 style="text-align:center; color:var(--neon-cyan); margin-top:50px; font-family:\'Orbitron\'">CARGANDO MEGAS...</h3>';
            document.querySelectorAll('.btn-gen').forEach(b => b.classList.remove('active'));
            if(event) event.target.classList.add('active');

            let buffer = '';
            megaKeys.sort((a, b) => a.name.localeCompare(b.name));
            for (const item of megaKeys) {
                buffer += await fetchPokemon(item.query, item.name);
            }
            container.innerHTML = buffer;
        }

        async function loadGen(genId) {
            const container = document.getElementById('pokedex');
            container.innerHTML = '<h3 style="text-align:center; color:var(--neon-cyan); margin-top:50px; font-family:\'Orbitron\'">ACCEDIENDO A DATABASE...</h3>';
            document.querySelectorAll('.btn-gen').forEach(b => b.classList.remove('active'));
            if(event) event.target.classList.add('active');

            const ranges = { 1:[1,151], 2:[152,251], 3:[252,386], 4:[387,493], 5:[494,649], 6:[650,721], 7:[722,809], 8:[810,905], 9:[906,1010] };
            const [start, end] = ranges[genId];
            
            let buffer = '';
            for(let i=start; i<=end; i++) {
                buffer += await fetchPokemon(i, null);
            }
            container.innerHTML = buffer;
        }
        
        async function loadHisui() {
            const container = document.getElementById('pokedex');
            container.innerHTML = '<h3 style="text-align:center; color:var(--neon-orange); margin-top:50px; font-family:\'Orbitron\'">FORMAS HISUI...</h3>';
            document.querySelectorAll('.btn-gen').forEach(b => b.classList.remove('active'));
            if(event) event.target.classList.add('active');

             const hisuiList = [
                "growlithe-hisui", "arcanine-hisui", "voltorb-hisui", "electrode-hisui", 
                "typhlosion-hisui", "qwilfish-hisui", "sneasel-hisui", "samurott-hisui", 
                "lilligant-hisui", "zorua-hisui", "zoroark-hisui", "braviary-hisui", 
                "sliggoo-hisui", "goodra-hisui", "avalugg-hisui", "decidueye-hisui", 
                "dialga-origin", "palkia-origin"
            ];
            
            let buffer = '';
            for (const name of hisuiList) {
                buffer += await fetchPokemon(name, null);
            }
            container.innerHTML = buffer;
        }

        async function handleSearch(event) {
            const container = document.getElementById('pokedex');
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const visibleCards = document.querySelectorAll('.card');
            
            visibleCards.forEach(card => {
                if (card.querySelector('.poke-name').innerText.toLowerCase().includes(query)) card.style.display = 'flex';
                else card.style.display = 'none';
            });

            if (event.key === 'Enter' && query.length > 0) {
                container.innerHTML = '<h3 style="text-align:center; color:var(--neon-cyan); margin-top:50px;">BUSCANDO...</h3>';
                
                // 1. Buscar en Megas primero
                const customMatch = megaKeys.find(p => p.name.toLowerCase().includes(query));
                if (customMatch) {
                    container.innerHTML = await fetchPokemon(customMatch.query, customMatch.name);
                }
                
                // 2. Buscar en API normal (Siempre, para mostrar todas las variantes)
                const apiResult = await fetchPokemon(query.replace(/ /g, '-'), null);
                if (apiResult) {
                    // Si ya mostramos el Mega (porque customMatch fue true), añadimos el normal abajo
                    if (customMatch) {
                        container.innerHTML += apiResult; 
                    } else {
                        container.innerHTML = apiResult;
                    }
                } else if (!customMatch) {
                    container.innerHTML = '<h3 style="text-align:center;">No encontrado.</h3>';
                }
            }
        }

        window.onload = () => loadGen(1);
    </script>
</body>
</html>